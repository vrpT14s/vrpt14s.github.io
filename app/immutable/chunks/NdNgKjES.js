import{Z as Y,_ as q,$ as ce,a0 as re,f as te,b as _e,s as O,h as A,a2 as pe,a as he,G as w,ar as me,r as ge,H as be,c as K,d as B,l as H,a3 as we,a7 as ye,g as W,j as Ee,i as N,as as xe,at as Te,au as Q,ab as se,W as ke,av as Ie,k as ne,p as Se,aw as Ae,ax as Ce,ay as J,az as le,a5 as Ne,aA as De,aa as Le,aB as Me,aC as He,Q as Re,aD as Oe,aE as Be,B as Je,y as G,x as P,I as Pe,K as X,M as Z,z as Ve,v as $e,C as j,F as V,J as R}from"./QMLitVTt.js";import"./DsnmJJEf.js";import{d as ze,s as Ue}from"./8jrKm2N9.js";import{i as We}from"./B3nogVK7.js";import{a as Fe,r as ee}from"./BXEWzauk.js";import{H as Ge}from"./ZGs-297g.js";import{u as k}from"./DdXyGsZo.js";function Ye(e){var r=ce,a=re;Y(null),q(null);try{return e()}finally{Y(r),q(a)}}function qe(e,r,a,t=a){e.addEventListener(r,()=>Ye(a));const l=e.__on_r;l?e.__on_r=()=>{l(),t(!0)}:e.__on_r=()=>t(!0),Fe()}function fa(e,r){return r}function Ke(e,r,a){for(var t=e.items,l=[],s=r.length,n=0;n<s;n++)De(r[n].e,l,!0);var h=s>0&&l.length===0&&a!==null;if(h){var m=a.parentNode;Le(m),m.append(a),t.clear(),T(e,r[0].prev,r[s-1].next)}Me(l,()=>{for(var o=0;o<s;o++){var _=r[o];h||(t.delete(_.k),T(e,_.prev,_.next)),le(_.e,!h)}})}function va(e,r,a,t,l,s=null){var n=e,h={flags:r,items:new Map,first:null};{var m=e;n=A?O(pe(m)):m.appendChild(te())}A&&he();var o=null,_=!1,b=new Map,i=me(()=>{var v=a();return ke(v)?v:v==null?[]:se(v)}),d,u;function f(){Qe(u,d,h,b,n,l,r,t,a),s!==null&&(d.length===0?o?ne(o):o=W(()=>s(n)):o!==null&&Se(o,()=>{o=null}))}_e(()=>{u??=re,d=w(i);var v=d.length;if(_&&v===0)return;_=v===0;let S=!1;if(A){var E=ge(n)===be;E!==(v===0)&&(n=K(),O(n),B(!1),S=!0)}if(A){for(var c=null,g,p=0;p<v;p++){if(H.nodeType===we&&H.data===ye){n=H,S=!0,B(!1);break}var I=d[p],x=t(I,p);g=F(H,h,c,null,I,x,p,l,r,a),h.items.set(x,g),c=g}v>0&&O(K())}if(A)v===0&&s&&(o=W(()=>s(n)));else if(Ee()){var C=new Set,y=N;for(p=0;p<v;p+=1){I=d[p],x=t(I,p);var D=h.items.get(x)??b.get(x);D?ie(D,I,p):(g=F(null,h,null,null,I,x,p,l,r,a,!0),b.set(x,g)),C.add(x)}for(const[L,M]of h.items)C.has(L)||y.skipped_effects.add(M.e);y.add_callback(f)}else f();S&&B(!0),w(i)}),A&&(n=H)}function Qe(e,r,a,t,l,s,n,h,m){var o=r.length,_=a.items,b=a.first,i=b,d,u=null,f=[],v=[],S,E,c,g;for(g=0;g<o;g+=1){if(S=r[g],E=h(S,g),c=_.get(E),c===void 0){var p=t.get(E);if(p!==void 0){t.delete(E),_.set(E,p);var I=u?u.next:i;T(a,u,p),T(a,p,I),$(p,I,l),u=p}else{var x=i?i.e.nodes_start:l;u=F(x,a,u,u===null?a.first:u.next,S,E,g,s,n,m)}_.set(E,u),f=[],v=[],i=u.next;continue}if(ie(c,S,g),(c.e.f&J)!==0&&ne(c.e),c!==i){if(d!==void 0&&d.has(c)){if(f.length<v.length){var C=v[0],y;u=C.prev;var D=f[0],L=f[f.length-1];for(y=0;y<f.length;y+=1)$(f[y],C,l);for(y=0;y<v.length;y+=1)d.delete(v[y]);T(a,D.prev,L.next),T(a,u,D),T(a,L,C),i=C,u=L,g-=1,f=[],v=[]}else d.delete(c),$(c,i,l),T(a,c.prev,c.next),T(a,c,u===null?a.first:u.next),T(a,u,c),u=c;continue}for(f=[],v=[];i!==null&&i.k!==E;)(i.e.f&J)===0&&(d??=new Set).add(i),v.push(i),i=i.next;if(i===null)continue;c=i}f.push(c),u=c,i=c.next}if(i!==null||d!==void 0){for(var M=d===void 0?[]:se(d);i!==null;)(i.e.f&J)===0&&M.push(i),i=i.next;var fe=M.length;if(fe>0){var ve=o===0?l:null;Ke(a,M,ve)}}e.first=a.first&&a.first.e,e.last=u&&u.e;for(var de of t.values())le(de.e);t.clear()}function ie(e,r,a,t){xe(e.v,r),e.i=a}function F(e,r,a,t,l,s,n,h,m,o,_){var b=(m&Ae)!==0,i=(m&Ce)===0,d=b?i?Te(l,!1,!1):Q(l):l,u=(m&Ie)===0?n:Q(n),f={i:u,v:d,k:s,a:null,e:null,prev:a,next:t};try{if(e===null){var v=document.createDocumentFragment();v.append(e=te())}return f.e=W(()=>h(e,d,u,o),A),f.e.prev=a&&a.e,f.e.next=t&&t.e,a===null?_||(r.first=f):(a.next=f,a.e.next=f.e),t!==null&&(t.prev=f,t.e.prev=f.e),f}finally{}}function $(e,r,a){for(var t=e.next?e.next.e.nodes_start:a,l=r?r.e.nodes_start:a,s=e.e.nodes_start;s!==null&&s!==t;){var n=Ne(s);l.before(s),s=n}}function T(e,r,a){r===null?e.first=a:(r.next=a,r.e.next=a&&a.e),a!==null&&(a.prev=r,a.e.prev=r&&r.e)}function ae(e,r,a=r){var t=He(),l=new WeakSet;qe(e,"input",s=>{var n=s?e.defaultValue:e.value;if(n=z(e)?U(n):n,a(n),N!==null&&l.add(N),t&&n!==(n=r())){var h=e.selectionStart,m=e.selectionEnd;e.value=n??"",m!==null&&(e.selectionStart=h,e.selectionEnd=Math.min(m,e.value.length))}}),(A&&e.defaultValue!==e.value||Re(r)==null&&e.value)&&(a(z(e)?U(e.value):e.value),N!==null&&l.add(N)),Oe(()=>{var s=r();if(e===document.activeElement){var n=Be??N;if(l.has(n))return}z(e)&&s===U(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function z(e){var r=e.type;return r==="number"||r==="range"}function U(e){return e===""?null:+e}const Xe="https://vrpweb.vrp-t14s.workers.dev";function Ze(e,r){throw new Ge(e,r)}new TextEncoder;async function oe({method:e,path:r,data:a}){const t={method:e,headers:{}};a&&(t.headers["Content-Type"]="application/json",t.body=JSON.stringify(a));let l=k.token;l&&(t.headers.Authorization=`Bearer ${l}`);const s=await fetch(`${Xe}/${r}`,t);if(s.ok||s.status===422){const n=await s.text();return n?JSON.parse(n):{}}s.status==419&&(console.log("JWT was expired"),k.id=null,k.token=null,localStorage.removeItem("userData")),Ze(s.status)}function da(e){return oe({method:"GET",path:e})}function ue(e,r){return oe({method:"POST",path:e,data:r})}async function je(e,r,a,t){console.log("Registering",w(r),w(a)),await ue("register",{username:w(r),password:w(a),email:""}),t()}var ea=G("<p> </p>"),aa=G('<button class="px-4 py-1 bg-amber-500 text-white rounded svelte-1ysg0p7">Register</button> <input class="px-2 py-1 border rounded" placeholder="Username"/> <input class="px-2 py-1 border rounded svelte-1ysg0p7" type="password" placeholder="Password"/> <button class="px-4 py-1 bg-green-500 text-white rounded svelte-1ysg0p7">Login</button>',1),ra=G('<div class="login-container svelte-1ysg0p7"><!></div>');function ca(e,r){Je(r,!0);let a=j(""),t=j("");async function l(){console.log("Logging in with",w(a),w(t));let o=await ue("login",{username:w(a),password:w(t)});console.log("user data",o),console.assert(o.token),k.id=o.id,k.token=o.token,localStorage.setItem("userData",JSON.stringify(k)),k.id=o.id,k.token=o.token,R(a,""),R(t,"")}var s=ra(),n=X(s);{var h=o=>{var _=ea(),b=X(_);Z(_),Ve(()=>Ue(b,`Logged in as user no. ${k.id??""}`)),P(o,_)},m=o=>{var _=aa(),b=$e(_);b.__click=[je,a,t,l];var i=V(b,2);ee(i);var d=V(i,2);ee(d);var u=V(d,2);u.__click=l,ae(i,()=>w(a),f=>R(a,f)),ae(d,()=>w(t),f=>R(t,f)),P(o,_)};We(n,o=>{k.id?o(h):o(m,!1)})}Z(s),P(e,s),Pe()}ze(["click"]);export{ca as L,ae as b,va as e,da as g,fa as i,ue as p};
